<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Our Valentine's Week</title>
    <link rel="stylesheet" href="styles.css?v=20">
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Quicksand:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container timeline-container">
        <div class="heart-bg"></div>
        
        <!-- Toast Notification -->
        <div id="toast" class="toast">No peeking! Wait for the day to arrive! ðŸ¤«</div>
        
        <!-- Timeline Section -->
        <div id="timeline-section">
            <h1 class="title">Valentine's Week</h1>
            
            <!-- Love Quote Section -->
            <div class="quote-container">
                <div id="love-quote" class="quote-text"></div>
            </div>

            <div class="timeline">
                <!-- Cards will be generated by JS -->
            </div>
        </div>
    </div>
    <script src="days-data.js?v=20"></script>
    <script>
        // Timeline Generation Logic
        const timeline = document.querySelector('.timeline');
        const toast = document.getElementById('toast');

        function showToast(message) {
            toast.innerText = message;
            toast.classList.add("show");
            setTimeout(() => toast.classList.remove("show"), 3000);
        }

        // Date Logic for Locking
        const currentYear = new Date().getFullYear();
        
        const monthMap = {
            "Jan": "01", "Feb": "02", "Mar": "03", "Apr": "04", "May": "05", "Jun": "06",
            "Jul": "07", "Aug": "08", "Sep": "09", "Oct": "10", "Nov": "11", "Dec": "12"
        };

        function getTargetTimestampHK(dateStr, year) {
            // dateStr like "Feb 7"
            const [monthName, day] = dateStr.split(" ");
            const month = monthMap[monthName];
            const dayPadded = day.length === 1 ? "0" + day : day;
            
            // ISO string: "2025-02-07T00:00:00+08:00" (HK Time)
            const isoString = `${year}-${month}-${dayPadded}T00:00:00+08:00`;
            return new Date(isoString).getTime();
        }

        daysData.forEach((day, index) => {
            // Calculate locked state using HK time
            const targetTime = getTargetTimestampHK(day.date, currentYear);
            const now = Date.now();
            
            // Lock everything based on target time
            const isLocked = targetTime > now;

            const card = document.createElement('div');
            card.classList.add('day-card');
            if (isLocked) {
                card.classList.add('locked');
            }
            
            // Stagger animation
            card.style.animationDelay = `${index * 0.1}s`;
            
            card.innerHTML = `
                <div class="date">${day.date}</div>
                <div class="day-name">${day.name}</div>
                <div class="card-content">
                    ${isLocked 
                        ? `
                            <div style="text-align:center; width:100%">
                                <div class="icon">ðŸ”’</div>
                                <div class="card-countdown" data-target="${targetTime}" data-image="${day.image}" data-name="${day.name}">
                                    <div><span>00</span><label>Days</label></div>
                                    <div><span>00</span><label>Hrs</label></div>
                                    <div><span>00</span><label>Mins</label></div>
                                    <div><span>00</span><label>Secs</label></div>
                                </div>
                            </div>
                          ` 
                        : `<img src="${day.image}" alt="${day.name}" class="card-image">`
                    }
                </div>
            `;
            
            card.addEventListener('click', () => {
                // Check class instead of variable to support dynamic unlocking
                if (!card.classList.contains('locked')) {
                    window.location.href = `day.html?id=${day.id}`;
                } else {
                    // Shake animation
                    card.classList.add('shake');
                    setTimeout(() => card.classList.remove('shake'), 400);
                    
                    // Toast notification
                    showToast("No peeking! Wait for the day to arrive! ðŸ¤«");
                }
            });
            
            timeline.appendChild(card);
        });

        // Card Countdown Logic
        function updateCardCountdowns() {
            const now = new Date().getTime();
            document.querySelectorAll('.card-countdown').forEach(el => {
                const target = parseInt(el.getAttribute('data-target'));
                const distance = target - now;
                
                if (distance < 0) {
                    // Find the parent card
                    const card = el.closest('.day-card');
                    if (card && card.classList.contains('locked')) {
                        // Unlock it!
                        card.classList.remove('locked');
                        
                        // Retrieve image info
                        const imageSrc = el.getAttribute('data-image');
                        const name = el.getAttribute('data-name');
                        
                        // Replace content
                        const cardContent = card.querySelector('.card-content');
                        if (cardContent) {
                            cardContent.innerHTML = `<img src="${imageSrc}" alt="${name}" class="card-image" style="animation: fadeIn 0.5s">`;
                        }
                        
                        // Show a nice toast message
                        showToast(`âœ¨ ${name} is now unlocked! âœ¨`);
                    }
                    return;
                }
                
                const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);
                
                const spans = el.querySelectorAll('span');
                if (spans.length === 4) {
                    spans[0].innerText = String(days).padStart(2, '0');
                    spans[1].innerText = String(hours).padStart(2, '0');
                    spans[2].innerText = String(minutes).padStart(2, '0');
                    spans[3].innerText = String(seconds).padStart(2, '0');
                }
            });
        }
        setInterval(updateCardCountdowns, 1000);
        updateCardCountdowns();

        // Add floating hearts background (reused from main script logic)
        function createHearts() {
            const heartBg = document.querySelector('.heart-bg');
            const heart = document.createElement('div');
            heart.classList.add('heart');
            heart.style.left = Math.random() * 100 + 'vw';
            heart.style.animationDuration = Math.random() * 3 + 3 + 's';
            heartBg.appendChild(heart);
            setTimeout(() => heart.remove(), 6000);
        }
        setInterval(createHearts, 300);

        // Romantic Quote Logic
        const quotes = [
            "Every day with you is a new adventure.",
            "I can't wait to make more memories with you.",
            "You are my favorite notification.",
            "Counting down the seconds until I see you.",
            "My heart is perfect because you are in it.",
            "You are the best thing that ever happened to me.",
            "I love you more than pizza. And that's saying a lot.",
            "You are my sun, my moon, and all my stars.",
            "Meeting you was like listening to a song for the first time and knowing it would be my favorite."
        ];

        const quoteElement = document.getElementById('love-quote');
        // Pick a random quote
        const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
        quoteElement.innerText = `"${randomQuote}"`;
    </script>
</body>
</html>